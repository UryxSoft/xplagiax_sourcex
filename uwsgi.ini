[uwsgi]

; ============ APLICACIÓN ============
module = wsgi:app
callable = app

; ============ SOCKET ============
http = 0.0.0.0:5000
; Para producción con nginx:
; socket = /tmp/xplagiax.sock
; chmod-socket = 666

; ============ WORKERS ============
master = true
processes = 9
threads = 4
enable-threads = true

; ============ PERFORMANCE ============
; ✅ Thunder lock (mejor que default)
thunder-lock = true

; ✅ Lazy apps (menos memoria)
lazy-apps = true

; ✅ Buffer sizes
buffer-size = 32768
post-buffering = 8192

; ✅ Socket settings
socket-timeout = 300
listen = 2048
tcp-nodelay = true

; ✅ Harakiri (kill workers lentos)
harakiri = 300
harakiri-verbose = true

; ✅ Max requests por worker
max-requests = 1000
max-requests-delta = 50

; ✅ Vacuum (limpia memoria)
vacuum = true
single-interpreter = true

; ============ OPTIMIZACIONES PYTHON ============
; ✅ Preload modules
import = app
import = wsgi

; ✅ Python optimizations
py-call-osafterfork = true
enable-threads = true

; ============ CHEAPER MODE (auto-scaling) ============
; Escala workers según carga
cheaper = 2
cheaper-initial = 4
cheaper-step = 1
cheaper-overload = 5

; ============ LOGGING ============
logto = logs/uwsgi.log
log-4xx = true
log-5xx = true
disable-logging = false

; ============ STATS ============
stats = 127.0.0.1:9191
stats-http = true
memory-report = true

; ============ RELOAD ============
py-autoreload = 0
touch-reload = /tmp/uwsgi-reload

; ============ VIRTUALENV ============
virtualenv = venv/
pythonpath = .

; ============ MASTER FIFO ============
master-fifo = /tmp/uwsgi-fifo